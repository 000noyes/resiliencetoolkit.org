---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ActionButton from '@/components/ActionButton.astro';
import FAQItem from '@/components/FAQItem.astro';
import Badge from '@/components/Badge.astro';
import Card from '@/components/Card.astro';
import { Image } from 'astro:assets';
import logoImage from '@/assets/images/RHT_text.png';
---

<BaseLayout
  title="About the Community-Led Resilience Toolkit | Built by Vermont Flood Survivors"
  description="Free disaster response toolkit built by Vermont flood survivors. Get community organizing tools, emergency preparedness resources, and technical help from CROs."
>
  <!-- Hero Section - Elevator Pitch -->
  <section class="bg-gradient-to-b from-primary/10 to-background py-20">
    <div class="container mx-auto px-4 text-center max-w-4xl">
      <!-- <div class="flex justify-center mb-6">
        <div class="w-65 h-65 relative">
          <Image
            src={logoImage}
            alt="Resilience Hub Toolkit logo"
            width={520}
            height={520}
            quality={95}
            format="webp"
            loading="eager"
            decoding="sync"
            class="w-full h-full object-contain"
          />
        </div>
      </div> -->
      <h1 class="text-hero font-semibold mb-6 text-foreground">
        Community Resilience Hub Toolkit
      </h1>
      <p class="text-body-large text-muted-foreground mb-8 max-w-3xl mx-auto">
        Built by Vermont flood survivors who learned that when disaster strikes,
        neighbors are often the first and best responders. This free toolkit helps
        communities organize people, places, and supplies before, during, and after crisis.
      </p>
      <div class="flex flex-wrap gap-4 justify-center">
        <ActionButton href="/modules" variant="primary" size="lg">
          Explore the Toolkit
        </ActionButton>
        <ActionButton href="#contact" variant="outline" size="lg">
          Get Technical Help
        </ActionButton>
      </div>
    </div>
  </section>

  <!-- Problem/Solution Story -->
  <section class="py-16 bg-card">
    <div class="container mx-auto px-4 max-w-4xl">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
        <!-- Problem -->
        <div>
          <Badge variant="warning" class="mb-4">The Challenge</Badge>
          <h2 class="text-title font-semibold mb-4 text-foreground">
            When Floods Hit, Communities Needed Tools Fast
          </h2>
          <p class="text-body text-muted-foreground">
            Vermont's 2023 and 2024 flooding left communities scrambling.
            Government response was slow. Resources were scattered. People
            needed to organize supplies, volunteers, and information, but
            had no clear framework.
          </p>
        </div>

        <!-- Solution -->
        <div>
          <Badge variant="success" class="mb-4">The Solution</Badge>
          <h2 class="text-title font-semibold mb-4 text-foreground">
            Frontline Responders Built What Was Missing
          </h2>
          <p class="text-body text-muted-foreground">
            Community organizers, mutual aid groups, and flood survivors
            documented what actually worked. The result: a free, tested
            framework any community can use to build resilience before
            disaster strikes.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- What's Inside -->
  <section class="py-16">
    <div class="container mx-auto px-4 max-w-4xl">
      <h2 class="text-headline font-semibold mb-8 text-center text-foreground">
        What's Inside
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Before -->
        <div class="text-center">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-blue-100 dark:bg-blue-900 flex items-center justify-center">
            <svg class="w-8 h-8 text-blue-600 dark:text-blue-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
          </div>
          <h3 class="text-subtitle font-semibold mb-3 text-foreground">Before</h3>
          <p class="text-body-small text-muted-foreground">
            Map community assets, build volunteer networks, stockpile supplies
          </p>
        </div>

        <!-- During -->
        <div class="text-center">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-orange-100 dark:bg-orange-900 flex items-center justify-center">
            <svg class="w-8 h-8 text-orange-600 dark:text-orange-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
          </div>
          <h3 class="text-subtitle font-semibold mb-3 text-foreground">During</h3>
          <p class="text-body-small text-muted-foreground">
            Coordinate response, track needs, communicate with your community
          </p>
        </div>

        <!-- After -->
        <div class="text-center">
          <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center">
            <svg class="w-8 h-8 text-green-600 dark:text-green-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <h3 class="text-subtitle font-semibold mb-3 text-foreground">After</h3>
          <p class="text-body-small text-muted-foreground">
            Track recovery, support rebuilding, strengthen long-term resilience
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Origin Story (Revised) -->
  <section class="py-16 bg-muted">
    <div class="container mx-auto px-4 max-w-3xl">
      <h2 class="text-headline font-semibold mb-6 text-center text-foreground">
        Made by Communities, For Communities
      </h2>
      <div class="prose prose-lg max-w-none">
        <p class="text-body-large text-muted-foreground mb-6 text-center">
          We are community members, organizers, and caretakers. We made this
          toolkit because we needed it when the waters rose.
        </p>
        <p class="text-body text-muted-foreground text-center">
          When Vermont flooded in 2023 and 2024, neighbors became first responders.
          They organized supplies, coordinated volunteers, and mapped resources, often
          without official support. This toolkit captures that lived experience and
          makes it available to any community facing disaster.
        </p>
      </div>
    </div>
  </section>

  <!-- Collaborators (Redesigned) -->
  <section class="py-16">
    <div class="container mx-auto px-4 max-w-3xl">
      <h2 class="text-headline font-semibold mb-4 text-center text-foreground">
        Built With Grassroots Partners
      </h2>
      <p class="text-body text-muted-foreground mb-12 text-center max-w-xl mx-auto">
        In collaboration with frontline responders, community organizers,
        and mutual aid networks across Vermont:
      </p>

      <div class="text-center space-y-3">
        <p class="text-body text-foreground">Access Ecologies</p>
        <p class="text-body text-foreground">Community Resilience Organizations (CROs)</p>
        <p class="text-body text-foreground">Community Resilience for the Waterbury Area (CReW)</p>
        <p class="text-body text-foreground">Cooperation Vermont</p>
        <p class="text-body text-foreground">Lamoille Area Recovery Network (LeARN)</p>
        <p class="text-body text-foreground">Land Access and Opportunity Board (LAOB)</p>
        <p class="text-body text-foreground">Kingdom United Resilience and Recovery Effort (KURRVE)</p>
        <p class="text-body text-foreground">Northeast Kingdom Organizing (NEKO)</p>
        <p class="text-body text-foreground">Rose Core Collective</p>
        <p class="text-body text-foreground">Rural Vermont</p>
      </div>
    </div>
  </section>

  <!-- CRO Help Callout (Touchpoint #2) -->
  <section class="py-16 bg-muted">
    <div class="container mx-auto px-4 max-w-4xl">
      <div class="text-center">
        <h2 class="text-headline font-semibold mb-4 text-foreground">
          Need Help Getting Started?
        </h2>
        <p class="text-body-large text-muted-foreground mb-8 max-w-2xl mx-auto">
          Community Resilience Organizations (CROs) offers free consultations
          to help you assess your community's needs and create a resilience plan.
        </p>
        <div class="flex flex-wrap gap-4 justify-center">
          <ActionButton href="#contact" variant="primary" size="lg">
            Request Free Consultation
          </ActionButton>
          <ActionButton href="https://gocros.org/" variant="outline" size="lg">
            Learn About CROs
          </ActionButton>
        </div>
      </div>
    </div>
  </section>

  <!-- Services & Support (Enhanced) -->
  <section class="py-16">
    <div class="container mx-auto px-4 max-w-5xl">
      <header class="mb-12 text-center">
        <h2 class="text-headline font-semibold mb-4 text-foreground">
          Technical Assistance & Services
        </h2>
        <p class="text-body-large text-muted-foreground max-w-2xl mx-auto">
          CROs provides training, technical support, and services to help
          communities implement and customize the Resilience Hub Toolkit.
        </p>
      </header>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
        <!-- Fiscal Sponsorship Card -->
        <Card>
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <div>
              <h3 class="text-subtitle font-semibold mb-2 text-foreground">
                Fiscal Sponsorship
              </h3>
              <p class="text-body text-muted-foreground">
                Support for community organizations seeking funding for resilience initiatives.
              </p>
            </div>
          </div>
        </Card>

        <!-- Training & Facilitation Card -->
        <Card>
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
              </svg>
            </div>
            <div>
              <h3 class="text-subtitle font-semibold mb-2 text-foreground">
                Training & Facilitation
              </h3>
              <p class="text-body text-muted-foreground">
                Workshops and training sessions for community organizers and volunteers.
              </p>
            </div>
          </div>
        </Card>

        <!-- Technical Setup Card -->
        <Card>
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
              </svg>
            </div>
            <div>
              <h3 class="text-subtitle font-semibold mb-2 text-foreground">
                Technical Setup
              </h3>
              <p class="text-body text-muted-foreground">
                Help getting your resilience hub up and running with custom configurations.
              </p>
            </div>
          </div>
        </Card>

        <!-- Local Hosting Card -->
        <Card>
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center flex-shrink-0">
              <svg class="w-6 h-6 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2m-2-4h.01M17 16h.01" />
              </svg>
            </div>
            <div>
              <h3 class="text-subtitle font-semibold mb-2 text-foreground">
                Local Hosting
              </h3>
              <p class="text-body text-muted-foreground">
                Options for hosting your own instance of the toolkit with full data control.
              </p>
            </div>
          </div>
        </Card>
      </div>

      <!-- CTA to contact (Touchpoint #3) -->
      <div class="text-center">
        <p class="text-body text-muted-foreground mb-6">
          Ready to get started with any of these services?
        </p>
        <ActionButton href="#contact" variant="primary" size="lg">
          Contact CROs Team
        </ActionButton>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section id="faq" class="py-16 bg-muted">
    <div class="container mx-auto px-4 max-w-4xl">
      <h2 class="text-headline font-semibold mb-8 text-center text-foreground">
        Common Questions
      </h2>
      <div class="space-y-4">
        <FAQItem
          question="What is a Resilience Hub?"
          answer="A resilience hub can look many ways, but at its core, it is a centralized source of information, support, and supplies that supports community resilience. Read more about Resilience Hubs on the <a href='/introduction' class='text-primary hover:underline'>Introduction</a> page."
        />

        <FAQItem
          question="Who is this toolkit for?"
          answer="This toolkit is for community organizers, neighborhood groups, mutual aid networks, faith-based organizations, and anyone working to strengthen community resilience. No special training or technical skills are required."
        />

        <FAQItem
          question="Is this toolkit free to use?"
          answer="Yes, this toolkit is completely free and open-source. You can use it, modify it, and share it with others."
        />

        <FAQItem
          question="Do I need internet to use this toolkit?"
          answer="Not after your first visit. When you visit this toolkit for the first time with internet, your device automatically saves all the pages (like downloading an app). After that, you can use it anytime—even with WiFi off or in airplane mode.<br/><br/>To test it: turn off your WiFi and visit the site again. If it loads normally, it's working! You'll see a gray banner at the top saying 'You're working offline.'<br/><br/>Your checkmarks and notes save automatically and stay on your device. Learn more on our <a href='/downloads' class='text-primary hover:underline'>Downloads page</a>."
        />

        <FAQItem
          question="Is my information private and secure?"
          answer="Yes. All information you enter stays on your device in your web browser's storage. Nothing is sent to servers or stored in the cloud. The toolkit works fully offline once loaded, and your data never leaves your device."
        />

        <FAQItem
          question="Can I use this on my phone or tablet?"
          answer="Yes. The toolkit is designed to work on any device - phones, tablets, and computers. All features, including filling out forms, printing, and exporting data, work on mobile devices."
        />

        <FAQItem
          question="How do I save my work and transfer it to another device?"
          answer="On any module page, click the 'Export local data' button to download your information as a file. You can then email it to yourself, save it to a USB drive, or store it in cloud storage to transfer to another device. On the new device, use the 'Import data' button to load your information (Coming Soon)."
        />
      </div>
    </div>
  </section>

  <!-- License (Redesigned) -->
  <section class="py-12 border-t border-border">
    <div class="container mx-auto px-4 max-w-4xl">
      <div class="bg-card border border-border rounded-lg p-8">
        <h2 class="text-title font-semibold mb-4 text-foreground">
          Free & Open Source
        </h2>
        <p class="text-body text-muted-foreground mb-4">
          This toolkit is released under open licenses to ensure it remains freely
          available to communities everywhere:
        </p>
        <ul class="space-y-2 text-body text-muted-foreground">
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1">✓</span>
            <span><strong class="text-foreground">Code:</strong> Licensed under the <a href="/LICENSE" class="text-primary hover:underline">MIT License</a></span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1">✓</span>
            <span><strong class="text-foreground">Content:</strong> Released under Creative Commons licensing</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1">✓</span>
            <span><strong class="text-foreground">Free to use, modify, and share</strong> with attribution</span>
          </li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Contact (Touchpoint #4) -->
  <section id="contact" class="py-20 bg-muted">
    <div class="container mx-auto px-4 max-w-3xl">
      <div class="text-center mb-12">
        <h2 class="text-headline font-semibold mb-4 text-foreground">
          Let's Build Resilience Together
        </h2>
        <p class="text-body-large text-muted-foreground max-w-2xl mx-auto">
          Whether you need technical help, want to collaborate, or have questions
          about implementing the toolkit, CROs is here to support you.
        </p>
      </div>

      <div class="bg-card border border-border rounded-lg p-8 shadow-card">
        <form id="contact-form" class="space-y-6">
          <div id="form-fields">
            <div class="mb-4">
              <label for="contact-email" class="block text-body font-medium text-foreground mb-2">
                Email Address
              </label>
              <input
                type="email"
                id="contact-email"
                name="email"
                placeholder="your@email.com"
                class="w-full px-4 py-3 border border-border rounded-lg bg-background text-foreground focus:ring-2 focus:ring-primary focus:border-primary transition-colors"
                required
                aria-required="true"
              />
            </div>
            <div class="mb-4">
              <label for="contact-message" class="block text-body font-medium text-foreground mb-2">
                How Can We Help?
              </label>
              <textarea
                id="contact-message"
                name="message"
                rows="5"
                placeholder="Tell us about your community and what you're hoping to accomplish..."
                class="w-full px-4 py-3 border border-border rounded-lg bg-background text-foreground focus:ring-2 focus:ring-primary focus:border-primary transition-colors resize-y"
                required
                aria-required="true"
              ></textarea>
              <!-- <p class="text-body-small text-muted-foreground mt-2">
                We typically respond within 2-3 business days
              </p> -->
            </div>
            <button
              type="submit"
              class="w-full inline-flex items-center justify-center font-medium transition-all duration-default ease-default focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 active:translate-y-px rounded-lg bg-primary text-primary-foreground shadow-sm hover:shadow-raised hover:bg-primary/90 px-6 py-3 text-body"
            >
              Send Message
            </button>
          </div>
          <div id="success-message" class="hidden text-center py-8">
            <div class="inline-flex items-center justify-center w-12 h-12 mb-4 relative">
              <svg class="w-12 h-12 absolute" viewBox="0 0 48 48">
                <circle
                  cx="24"
                  cy="24"
                  r="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="3"
                  class="text-primary/10"
                />
              </svg>
              <svg
                id="progress-ring"
                class="w-12 h-12 absolute -rotate-90"
                viewBox="0 0 48 48"
              >
                <circle
                  cx="24"
                  cy="24"
                  r="20"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="3"
                  stroke-linecap="round"
                  class="text-primary"
                  stroke-dasharray="125.6"
                  stroke-dashoffset="125.6"
                />
              </svg>
            </div>
            <p class="text-body font-medium text-foreground">
              Opening your email client...
            </p>
            <!-- <p class="text-body-small text-muted-foreground mt-2">
              or email us directly at <a href="mailto:resiliencetoolkit@gocros.org" class="text-primary hover:underline">resiliencetoolkit@gocros.org</a>
            </p> -->
          </div>
        </form>

        <!-- Direct email fallback -->
        <div class="mt-6 pt-6 border-t border-border text-center">
          <p class="text-body-small text-muted-foreground mb-3">
            Prefer to email directly?
          </p>
          <a
            href="mailto:resiliencetoolkit@gocros.org"
            class="text-body font-medium text-primary hover:underline"
          >
            resiliencetoolkit@gocros.org
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  @keyframes progressFill {
    from {
      stroke-dashoffset: 125.6;
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  #progress-ring circle {
    animation: none;
  }

  #progress-ring.animating circle {
    animation: progressFill 5s linear forwards;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const formFields = document.getElementById('form-fields');
    const successMessage = document.getElementById('success-message');
    const progressRing = document.getElementById('progress-ring');

    if (form) {
      form.addEventListener('submit', (e: Event) => {
        e.preventDefault();

        const emailInput = document.getElementById('contact-email') as HTMLInputElement;
        const messageInput = document.getElementById('contact-message') as HTMLTextAreaElement;

        const userEmail = emailInput?.value.trim();
        const message = messageInput?.value.trim();

        if (!userEmail || !message) {
          return;
        }

        // Create mailto link with subject and body
        const subject = encodeURIComponent('Resilience Toolkit Contact');
        const body = encodeURIComponent(`Message: ${message}\n\nFrom: ${userEmail}`);
        const mailtoLink = `mailto:resiliencetoolkit@gocros.org?subject=${subject}&body=${body}`;

        // Show success message and hide form fields
        if (formFields && successMessage && progressRing) {
          formFields.classList.add('hidden');
          successMessage.classList.remove('hidden');
          progressRing.classList.add('animating');
        }

        // Open email client after 5 seconds
        setTimeout(() => {
          window.location.href = mailtoLink;
        }, 5000);

        // Reset form after 7 seconds
        setTimeout(() => {
          form.reset();
          if (formFields && successMessage && progressRing) {
            formFields.classList.remove('hidden');
            successMessage.classList.add('hidden');
            progressRing.classList.remove('animating');
          }
        }, 7000);
      });
    }
  });
</script>
