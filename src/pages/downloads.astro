---
import BaseLayout from '@/layouts/BaseLayout.astro';
import Card from '@/components/Card.astro';
import ActionButton from '@/components/ActionButton.astro';
import ExternalLink from '@/components/ExternalLink.astro';
import { Download, FileText, FolderOpen, FileSpreadsheet, ExternalLink as ExternalLinkIcon } from 'lucide-react';
import { featuredDownloads, getModulesBySection } from '@/data/downloads';

const modulesBySection = getModulesBySection();
const sectionOrder = ['Section 0', 'Section 1', 'Section 2'];
---

<BaseLayout title="Resource Downloads | Resilience Hub Toolkit" description="Download PDFs, templates, and resources for building community resilience.">
  <article class="container mx-auto px-4 py-8 max-w-6xl">
    <!-- Page Header -->
    <header class="mb-12">
      <h1 class="text-hero font-semibold mb-4">
        Resource Downloads
      </h1>
      <p class="text-lg text-text-secondary">
        Download individual module PDFs, access the complete toolkit, and find templates and resources for building community resilience.
      </p>
      <p class="text-body-small text-text-muted mt-2">
        Last updated: December 2, 2025
      </p>
    </header>

    <!-- How Automatic Offline Works -->
    <!-- <section class="mb-12">
      <div class="bg-primary/5 border border-primary/20 rounded-lg p-6">
        <h2 class="text-2xl font-semibold text-foreground mb-4">How Offline Access Works (Automatic)</h2>
        <p class="text-muted-foreground mb-4">
          When you visit this toolkit for the first time, your browser automatically downloads and saves all pages. This happens in the background (you don't need to do anything).
        </p>
        <ul class="space-y-3 text-muted-foreground">
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1 text-xl">✓</span>
            <span><strong class="text-foreground">All 28+ pages cached automatically</strong> on your first visit</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1 text-xl">✓</span>
            <span><strong class="text-foreground">Works completely offline</strong> after the first visit—no need to visit each page</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1 text-xl">✓</span>
            <span><strong class="text-foreground">Your data stays private</strong> on your device—never sent to servers</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1 text-xl">✓</span>
            <span><strong class="text-foreground">Automatic background sync</strong> when you reconnect to the internet</span>
          </li>
          <li class="flex items-start gap-3">
            <span class="text-primary mt-1 text-xl">✓</span>
            <span><strong class="text-foreground">No action needed from you</strong>—full offline access is automatic</span>
          </li>
        </ul>
      </div>
    </section> -->

    <!-- Featured Downloads Section -->
    <section class="mb-16">
      <h2 class="text-title font-semibold mb-6">Featured Downloads</h2>

      <!-- Download PDF Group -->
      <section aria-labelledby="download-pdf-heading">
        <h3 id="download-pdf-heading" class="text-body-small font-semibold text-text-muted uppercase tracking-wide mb-4">
          Download PDF
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          {featuredDownloads.filter(d => !d.isExternal).map((download) => (
            <Card class="flex flex-col h-full">
              <div class="flex-1">
                <!-- Icon -->
                <div class="mb-4 text-primary">
                  {download.icon === 'pdf' ? (
                    <FileText size={32} />
                  ) : download.icon === 'spreadsheet' ? (
                    <FileSpreadsheet size={32} />
                  ) : (
                    <FileText size={32} />
                  )}
                </div>

                <!-- Title -->
                <h4 class="text-subtitle font-semibold mb-2 text-text-primary">
                  {download.title}
                </h4>

                <!-- Description -->
                <p class="text-body text-text-secondary mb-4">
                  {download.description}
                </p>

                {download.fileSize && (
                  <p class="text-body-small text-text-muted mb-4">
                    {download.fileSize}
                  </p>
                )}
              </div>

              <!-- Action Button -->
              <div class="mt-auto">
                <ActionButton
                  href={download.downloadUrl}
                  variant="primary"
                  class="w-full flex items-center justify-center gap-2"
                >
                  <Download size={18} />
                  <span>Download PDF</span>
                </ActionButton>
              </div>
            </Card>
          ))}
        </div>
      </section>

      <!-- View Online Group -->
      <section class="mb-8 mt-12" aria-labelledby="view-online-heading">
        <h3 id="view-online-heading" class="text-body-small font-semibold text-text-muted uppercase tracking-wide mb-4">
          View Online
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {featuredDownloads.filter(d => d.isExternal).map((download) => (
            <Card class="flex flex-col h-full">
              <div class="flex-1">
                <!-- Icon -->
                <div class="mb-4 text-primary">
                  {download.icon === 'pdf' ? (
                    <FileText size={32} />
                  ) : download.icon === 'spreadsheet' ? (
                    <FileSpreadsheet size={32} />
                  ) : (
                    <FileText size={32} />
                  )}
                </div>

                <!-- Title -->
                <h4 class="text-subtitle font-semibold mb-2 text-text-primary">
                  {download.title}
                </h4>

                <!-- Description -->
                <p class="text-body text-text-secondary mb-4">
                  {download.description}
                </p>

                {download.fileSize && (
                  <p class="text-body-small text-text-muted mb-4">
                    {download.fileSize}
                  </p>
                )}
              </div>

              <!-- Action Button -->
              <div class="mt-auto">
                <ExternalLink
                  href={download.downloadUrl}
                  class="inline-block w-full"
                >
                  <ActionButton
                    variant="outline"
                    class="w-full flex items-center justify-center gap-2 pointer-events-none"
                  >
                    <ExternalLinkIcon size={18} />
                    <span>View Online</span>
                  </ActionButton>
                </ExternalLink>
              </div>
            </Card>
          ))}
        </div>
      </section>
    </section>

    <!-- Module Downloads Table -->
    <section>
      <h2 class="text-title font-semibold mb-6">Module Downloads</h2>

      <div class="rounded-lg border border-border overflow-hidden">
        <table class="downloads-table">
          <caption class="sr-only">
            Downloadable modules organized by section with links to view online, download PDFs, and access additional resources
          </caption>

          <thead>
            <tr>
              <th scope="col">Module #</th>
              <th scope="col">Module Name</th>
              <th scope="col" class="text-center">View Online</th>
              <th scope="col" class="text-center">Download PDF</th>
              <th scope="col" class="text-center">Resources</th>
            </tr>
          </thead>

          <tbody>
            {sectionOrder.map((sectionName) => {
              const modules = modulesBySection.get(sectionName) || [];
              return (
                <>
                  {/* Section Header */}
                  <tr class="section-header">
                    <td colspan="5">
                      <strong>{sectionName}</strong>
                    </td>
                  </tr>

                  {/* Module Rows */}
                  {modules.map((module) => (
                    <tr>
                      <td data-label="Module #" class="module-number">
                        {module.number}
                      </td>
                      <td data-label="Module Name" class="module-name">
                        {module.name}
                      </td>
                      <td data-label="View Online" class="text-center action-cell">
                        <a
                          href={module.onlineUrl}
                          class="inline-flex items-center gap-2 text-table-link hover:text-table-link-hover transition-colors"
                          aria-label={`View ${module.name} online`}
                        >
                          <FileText size={18} />
                          <span>View</span>
                        </a>
                      </td>
                      <td data-label="Download PDF" class="text-center action-cell">
                        <a
                          href={`/toolkit/sections/${module.pdfFilename}`}
                          download
                          class="inline-flex items-center gap-2 text-table-link hover:text-table-link-hover transition-colors"
                          aria-label={`Download ${module.name} PDF`}
                        >
                          <Download size={18} />
                          <span>PDF</span>
                        </a>
                      </td>
                      <td data-label="Resources" class="text-center action-cell">
                        {module.resourcesUrl ? (
                          <ExternalLink
                            href={module.resourcesUrl}
                            class="inline-flex items-center gap-2"
                          >
                            <FolderOpen size={18} />
                            <span>Folder</span>
                          </ExternalLink>
                        ) : (
                          <span class="text-text-muted" aria-label="No additional resources available">—</span>
                        )}
                      </td>
                    </tr>
                  ))}
                </>
              );
            })}
          </tbody>
        </table>
      </div>
    </section>

    <!-- How to Print Instructions -->
    <section class="mb-12 mt-16">
      <h2 class="text-2xl font-semibold text-foreground mb-4">How to Print a Page</h2>
      <div class="bg-card border border-border rounded-lg p-6">
        <ol class="space-y-4">
          <li class="flex gap-4">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-semibold">1</span>
            <div>
              <h3 class="font-semibold text-foreground mb-1">Go to any module page</h3>
              <p class="text-sm text-muted-foreground">Browse the <a href="/modules" class="text-primary hover:underline">toolkit modules</a> and open the page you want to save.</p>
            </div>
          </li>
          <li class="flex gap-4">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-semibold">2</span>
            <div>
              <h3 class="font-semibold text-foreground mb-1">Click "Print this module"</h3>
              <p class="text-sm text-muted-foreground">Look for the button near the top of the page. This opens a printer-friendly version.</p>
            </div>
          </li>
          <li class="flex gap-4">
            <span class="flex-shrink-0 w-8 h-8 rounded-full bg-primary text-primary-foreground flex items-center justify-center font-semibold">3</span>
            <div>
              <h3 class="font-semibold text-foreground mb-1">Print or save as PDF</h3>
              <p class="text-sm text-muted-foreground">Choose your printer, or select "Save as PDF" to keep a digital copy on your device.</p>
            </div>
          </li>
        </ol>
      </div>
    </section>

    <!-- FAQ Section -->
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-foreground mb-6">Common Questions</h2>
      <div class="space-y-4">
        <details class="bg-card border border-border rounded-lg p-5">
          <summary class="font-semibold text-foreground cursor-pointer">
            Do I need internet to use the printed pages?
          </summary>
          <p class="text-sm text-muted-foreground mt-3">
            No. Once you've printed a page or saved it as a PDF on your device, you can use it anytime without internet.
          </p>
        </details>

        <details class="bg-card border border-border rounded-lg p-5">
          <summary class="font-semibold text-foreground cursor-pointer">
            Can I fill out the PDF on my computer or phone?
          </summary>
          <p class="text-sm text-muted-foreground mt-3">
            Yes. After saving as PDF, you can open it with most PDF readers (like Adobe Reader, Preview on Mac, or Chrome) and type directly into it. You can also print it and fill out by hand.
          </p>
        </details>

        <details class="bg-card border border-border rounded-lg p-5">
          <summary class="font-semibold text-foreground cursor-pointer">
            What's the difference between printing one page vs. downloading the whole toolkit?
          </summary>
          <p class="text-sm text-muted-foreground mt-3">
            Printing individual pages is great if you only need specific sections. Downloading the complete PDF gives you everything in one file, which is handy for sharing with your team or keeping a backup.
          </p>
        </details>

        <details class="bg-card border border-border rounded-lg p-5">
          <summary class="font-semibold text-foreground cursor-pointer">
            Will my information be saved if I fill out forms on this website?
          </summary>
          <p class="text-sm text-muted-foreground mt-3">
            Yes. All pages and your information are saved on your device automatically (in your web browser's storage). It stays private, never leaves your device, and works completely offline. If you want to keep a backup or transfer to another device, use the "Export local data" button on any module page.
          </p>
        </details>

        <details class="bg-card border border-border rounded-lg p-5">
          <summary class="font-semibold text-foreground cursor-pointer">
            How do I save my work and use it on a different device?
          </summary>
          <p class="text-sm text-muted-foreground mt-3">
            On any module page, click "Export local data" to download your information. You can then email it to yourself or save it to a USB drive to transfer to another device.
          </p>
        </details>

        <details class="bg-card border border-border rounded-lg p-5">
          <summary class="font-semibold text-foreground cursor-pointer">
            Does this work on my phone?
          </summary>
          <p class="text-sm text-muted-foreground mt-3">
            Yes. You can use this toolkit on any phone, tablet, or computer. The print and save features work on all devices.
          </p>
        </details>
      </div>
    </section>

    <!-- Back Navigation -->
    <nav class="mt-12">
      <a
        href="/modules"
        class="inline-flex items-center text-text-secondary hover:text-text-primary transition-colors"
      >
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        <span>Back to Modules</span>
      </a>
    </nav>
  </article>
</BaseLayout>

<style>
  /* ========================================
     Downloads Table Styles
     ======================================== */

  .downloads-table {
    width: 100%;
    border-collapse: collapse;
    background-color: var(--table-surface);
  }

  /* Table Header */
  .downloads-table th {
    padding: var(--table-cell-padding-y) var(--table-cell-padding-x);
    background-color: var(--table-surface-subtle);
    color: var(--table-heading);
    font-weight: 600;
    font-size: 14px;
    letter-spacing: var(--tracking-wide);
    text-transform: uppercase;
    border-bottom: 2px solid var(--table-divider);
    text-align: left;
  }

  .downloads-table th.text-center {
    text-align: center;
  }

  /* Table Cells */
  .downloads-table td {
    padding: var(--table-cell-padding-y) var(--table-cell-padding-x);
    color: var(--table-body);
    border-bottom: 1px solid var(--table-divider);
    vertical-align: middle;
  }

  /* Module Number Column */
  .downloads-table .module-number {
    font-weight: 600;
    color: var(--table-heading);
    width: 100px;
    white-space: nowrap;
  }

  /* Module Name Column */
  .downloads-table .module-name {
    font-weight: 500;
  }

  /* Action Cells */
  .downloads-table .action-cell {
    width: 120px;
  }

  /* Row Hover Effect */
  .downloads-table tbody tr:not(.section-header):hover {
    background-color: var(--table-surface-subtle);
    transition: background-color var(--motion-duration-fast) var(--motion-easing);
  }

  /* Section Header Rows */
  .downloads-table .section-header td {
    background-color: var(--table-accent-subtle);
    color: var(--table-heading);
    font-weight: 600;
    font-size: 15px;
    padding: var(--spacing-sm) var(--table-cell-padding-x);
    border-bottom: 2px solid var(--table-divider);
  }

  /* Links in Table */
  .downloads-table a {
    text-decoration: none;
    font-weight: 500;
  }

  .downloads-table a:hover {
    text-decoration: underline;
  }

  /* Focus States */
  .downloads-table a:focus {
    outline: 2px solid var(--table-focus-ring);
    outline-offset: 2px;
    border-radius: 4px;
  }

  /* ========================================
     Responsive Design - Mobile
     ======================================== */

  @media (max-width: 768px) {
    /* Hide table header on mobile */
    .downloads-table thead {
      display: none;
    }

    /* Transform table structure to blocks */
    .downloads-table,
    .downloads-table tbody,
    .downloads-table tr {
      display: block;
      width: 100%;
    }

    /* Style rows as cards */
    .downloads-table tbody tr:not(.section-header) {
      margin-bottom: var(--spacing-md);
      border: 1px solid var(--table-divider);
      border-radius: var(--radius-lg);
      background-color: var(--table-surface);
    }

    /* Section headers remain full width */
    .downloads-table .section-header {
      margin-bottom: var(--spacing-sm);
      border-radius: var(--radius-md);
    }

    /* Style cells as stacked content */
    .downloads-table td {
      display: block;
      text-align: left !important;
      padding: var(--spacing-sm) var(--spacing-md);
      border-bottom: none;
      width: 100%;
    }

    /* Add labels before content on mobile */
    .downloads-table td:before {
      content: attr(data-label);
      font-weight: 600;
      text-transform: uppercase;
      font-size: 12px;
      color: var(--table-text-muted);
      letter-spacing: var(--tracking-wide);
      display: block;
      margin-bottom: var(--spacing-xs);
    }

    /* Don't show label for section headers */
    .downloads-table .section-header td:before {
      display: none;
    }

    /* Add spacing between fields */
    .downloads-table td:not(:last-child) {
      border-bottom: 1px solid var(--table-divider);
    }

    /* Action cells on mobile */
    .downloads-table .action-cell {
      width: 100%;
    }

    .downloads-table .action-cell a {
      display: inline-flex;
    }
  }

  /* ========================================
     Tablet Adjustments
     ======================================== */

  @media (min-width: 769px) and (max-width: 1024px) {
    .downloads-table th,
    .downloads-table td {
      padding: 10px 12px;
      font-size: 14px;
    }

    .downloads-table .action-cell {
      width: 100px;
    }
  }
</style>
