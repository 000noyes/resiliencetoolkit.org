---
import BaseLayout from '@/layouts/BaseLayout.astro';
import ActionButton from '@/components/ActionButton.astro';
import FAQItem from '@/components/FAQItem.astro';
---

<BaseLayout title="Support - Resilience Hub" description="Fiscal sponsorship, services, training, and contact">
  <div class="container mx-auto px-4 py-12 max-w-3xl">
    <h1 class="text-4xl font-bold text-foreground mb-6">Support & Services</h1>
    <p class="text-lg text-muted-foreground mb-12">
      We offer training, technical support, and services to help communities
      implement and customize the Resilience Hub Toolkit.
    </p>

    <div class="space-y-12">
      <!-- Services -->
      <section>
        <h2 class="text-2xl font-semibold text-foreground mb-6">Services</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="bg-card border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-foreground mb-2">Fiscal Sponsorship</h3>
            <p class="text-sm text-muted-foreground">
              Support for community organizations seeking funding for resilience initiatives.
            </p>
          </div>

          <div class="bg-card border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-foreground mb-2">Training & Facilitation</h3>
            <p class="text-sm text-muted-foreground">
              Workshops and training sessions for community organizers and volunteers.
            </p>
          </div>

          <div class="bg-card border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-foreground mb-2">Technical Setup</h3>
            <p class="text-sm text-muted-foreground">
              Help getting your resilience hub up and running with custom configurations.
            </p>
          </div>

          <div class="bg-card border border-border rounded-lg p-6">
            <h3 class="text-lg font-semibold text-foreground mb-2">Local Hosting</h3>
            <p class="text-sm text-muted-foreground">
              Options for hosting your own instance of the toolkit with full data control.
            </p>
          </div>
        </div>
      </section>

      <!-- Get Help -->
      <section>
        <h2 class="text-2xl font-semibold text-foreground mb-6">Get Help</h2>
        <div class="bg-muted p-6 rounded-lg">
          <p class="text-muted-foreground mb-4">
            Need assistance? Have questions? We're here to help.
          </p>
          <ul class="list-disc list-inside space-y-2 text-sm text-muted-foreground mb-6">
            <li>Check our <a href="#faq" class="text-primary hover:underline">frequently asked questions</a> below</li>
            <li>Join our community forum (coming soon)</li>
            <li>Report issues on GitHub</li>
            <li><a href="#contact" class="text-primary hover:underline">Contact Us</a> directly</li>
          </ul>
        </div>
      </section>

      <!-- FAQ -->
      <section id="faq">
        <h2 class="text-2xl font-semibold text-foreground mb-6">Frequently Asked Questions</h2>
        <div class="space-y-4">
          <FAQItem
            question="What is a Community Resilience Hub?"
            answer="A Community Resilience Hub is a safe, accessible place where neighbors can gather during emergencies to share resources, get information, and support each other. This toolkit helps you plan, organize, and run a hub in your community."
          />

          <FAQItem
            question="Who is this toolkit for?"
            answer="This toolkit is for community organizers, neighborhood groups, mutual aid networks, faith-based organizations, and anyone working to strengthen community resilience. No special training or technical skills are required."
          />

          <FAQItem
            question="Is this toolkit free to use?"
            answer="Yes, this toolkit is completely free and open-source. You can use it, modify it, and share it with others. We believe everyone should have access to tools for building community resilience."
          />

          <FAQItem
            question="Do I need internet to use this toolkit?"
            answer="No. While the toolkit works online, you can also use it offline by saving pages as PDFs or printing them. Any data you enter in the web forms is saved automatically in your browser and works without internet. Learn more on the <a href='/offline' class='text-primary hover:underline'>Save for Offline Use</a> page."
          />

          <FAQItem
            question="Is my information private and secure?"
            answer="Yes. The toolkit offers two modes:<br><br><strong>Guest Mode (No Account):</strong> All information you enter stays on your device in your browser's local storage. Nothing is sent to servers or stored in the cloud. Your data is completely private and under your control.<br><br><strong>Account Mode (Optional):</strong> If you create an account, your data is synced to cloud storage (Supabase) so you can access it from any device. Your data is encrypted in transit, and the database enforces that only you and hub members you explicitly invite can view or edit your information. You can export your data anytime using the 'Export local data' button on module pages."
          />

          <FAQItem
            question="Can I use this on my phone or tablet?"
            answer="Yes. The toolkit is designed to work on any device - phones, tablets, and computers. All features, including filling out forms, printing, and exporting data, work on mobile devices."
          />

          <FAQItem
            question="How do I save my work and transfer it to another device?"
            answer="On any module page, click the 'Export local data' button to download your information as a file. You can then email it to yourself, save it to a USB drive, or store it in cloud storage to transfer to another device. On the new device, use the 'Import data' button to load your information (Coming Soon)."
          />

          <FAQItem
            question="How can I report a problem or suggest an improvement?"
            answer="We welcome feedback! You can report issues or suggest features on our <a href='https://github.com/yourusername/resiliencetoolkit' class='text-primary hover:underline' target='_blank' rel='noopener noreferrer'>GitHub repository</a> or <a href='#contact' class='text-primary hover:underline'>contact us directly</a> using the form below."
          />
        </div>
      </section>

      <!-- Contact -->
      <section id="contact">
        <h2 class="text-2xl font-semibold text-foreground mb-6">Contact</h2>
        <div class="bg-card border border-border rounded-lg p-8">
          <p class="text-muted-foreground mb-6">
            Interested in our services or have questions about the toolkit?
            Reach out to discuss how we can support your community.
          </p>
          <form id="contact-form" class="space-y-4">
            <div id="form-fields">
              <!-- <div class="mb-4">
                <label for="contact-email" class="block text-sm font-medium text-foreground mb-2">Email</label>
                <input
                  type="email"
                  id="contact-email"
                  name="email"
                  placeholder="your@email.com"
                  class="w-full px-4 py-2 border border-border rounded-md bg-background text-foreground"
                  required
                />
              </div> -->
              <div class="mb-4">
                <label for="contact-message" class="block text-sm font-medium text-foreground mb-2">Message</label>
                <textarea
                  id="contact-message"
                  name="message"
                  rows="4"
                  placeholder="How can we help?"
                  class="w-full px-4 py-2 border border-border rounded-md bg-background text-foreground"
                  required
                ></textarea>
              </div>
              <button
                type="submit"
                class="inline-flex items-center justify-center font-medium transition-all duration-default ease-default focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 active:translate-y-px rounded-lg bg-primary text-primary-foreground shadow-sm hover:shadow-raised hover:bg-primary/90 px-6 py-2.5 text-body"
              >
                Send Message
              </button>
            </div>
            <div id="success-message" class="hidden text-center py-8">
              <div class="inline-flex items-center justify-center w-12 h-12 mb-4 relative">
                <svg class="w-12 h-12 absolute" viewBox="0 0 48 48">
                  <circle
                    cx="24"
                    cy="24"
                    r="20"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                    class="text-primary/10"
                  />
                </svg>
                <svg
                  id="progress-ring"
                  class="w-12 h-12 absolute -rotate-90"
                  viewBox="0 0 48 48"
                >
                  <circle
                    cx="24"
                    cy="24"
                    r="20"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="3"
                    stroke-linecap="round"
                    class="text-primary"
                    stroke-dasharray="125.6"
                    stroke-dashoffset="125.6"
                  />
                </svg>
              </div>
              <p class="text-body font-medium text-foreground">
                Opening your email client...
              </p>
              <p class="text-sm text-muted-foreground mt-2">
                I'll read this myself. It goes to a real inbox. âš˜ rhizome
              </p>
            </div>
          </form>
        </div>
      </section>
    </div>
  </div>
</BaseLayout>

<style>
  @keyframes progressFill {
    from {
      stroke-dashoffset: 125.6;
    }
    to {
      stroke-dashoffset: 0;
    }
  }

  #progress-ring circle {
    animation: none;
  }

  #progress-ring.animating circle {
    animation: progressFill 5s linear forwards;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const formFields = document.getElementById('form-fields');
    const successMessage = document.getElementById('success-message');
    const progressRing = document.getElementById('progress-ring');

    if (form) {
      form.addEventListener('submit', (e: Event) => {
        e.preventDefault();

        const emailInput = document.getElementById('contact-email') as HTMLInputElement;
        const messageInput = document.getElementById('contact-message') as HTMLTextAreaElement;

        const userEmail = emailInput?.value.trim();
        const message = messageInput?.value.trim();

        if (!userEmail || !message) {
          return;
        }

        // Create mailto link with subject and body
        const subject = encodeURIComponent('Resilience Toolkit Contact');
        const body = encodeURIComponent(`Message: ${message}\n\nFrom: ${userEmail}`);
        const mailtoLink = `mailto:rhizome@cafeaccess.com?subject=${subject}&body=${body}`;

        // Show success message and hide form fields
        if (formFields && successMessage && progressRing) {
          formFields.classList.add('hidden');
          successMessage.classList.remove('hidden');
          progressRing.classList.add('animating');
        }

        // Open email client after 5 seconds
        setTimeout(() => {
          window.location.href = mailtoLink;
        }, 5000);

        // Reset form after 7 seconds
        setTimeout(() => {
          form.reset();
          if (formFields && successMessage && progressRing) {
            formFields.classList.remove('hidden');
            successMessage.classList.add('hidden');
            progressRing.classList.remove('animating');
          }
        }, 7000);
      });
    }
  });
</script>
